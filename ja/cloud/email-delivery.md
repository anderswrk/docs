# メール配信

## アプリケーションからメールを送信する

アプリケーションは、ユーザー登録、パスワードリセット、通知、領収書、またはその他のメッセージニーズのためにメールを送信できます。Klivは、レート制限、テンプレート管理、カスタムSMTPサーバーのサポートを備えた完全なメールシステムを含んでいます。

**すぐに使える**状態で、デフォルトのプラットフォームサーバーを使用して即座にメールを送信できます。しかし、他のプラットフォーム（Supabaseなど）と同様に、これらのデフォルトには厳しいレート制限があります — 1日あたりわずか2通、1時間あたり2通 — 悪用を防ぐためです。本番アプリケーションの場合、独自のメールサービスを設定することをお勧めします。

## カスタムSMTP設定

独自のSMTPサーバーを設定すると、レート制限が劇的に増加し、デフォルトで1日500通、1時間50通になり、ニーズの増加に応じてさらに高い制限（1日最大10,000通）を設定できます。

**カスタムSMTPで得られるもの**：
- **劇的に高い制限** - 1日2通/1時間2通ではなく、1日500通/1時間50通
- **独自の送信者アドレス** - 汎用アドレスではなく、あなたのドメインからメールが送信されます
- **配信追跡** - メール配信とバウンスのより良い可視性
- **暗号化された資格情報** - SMTPパスワードは暗号化され、完全には表示されません
- **接続テスト** - 保存前にSMTP設定が機能することを確認
- **自動管理** - 資格情報を提供すると、AIがSMTP設定を構成できます

## メール配信の設定

AIにメールを送信したいと伝えると、設定プロセスをガイドします。メールサービスプロバイダー（信頼性の高いメール配信を専門とする会社）からの資格情報が必要です。必要な情報を提供すると、AIは自動的に接続を設定できます。

**一般的なメールサービスプロバイダー**：

### Gmail / Google Workspace
Googleサービスを既に使用している小規模プロジェクトやチームに最適です。無料枠が利用可能ですが、日次送信制限があります。セキュリティのためにアプリ固有のパスワードが必要です。

### SendGrid
トランザクションメール（領収書、通知、パスワードリセット）に人気の選択肢。無料枠には1日100通のメールが含まれています。成長するアプリケーションに適しています。詳細な配信分析を提供します。

### Mailgun
優れた配信性を備えた開発者向けサービス。無料枠は月5,000通のメールを提供します。配信ステータスを追跡するための強力なAPIとWebhookサポート。

### Amazon SES (Simple Email Service)
大量送信に非常にコスト効率的（1,000通あたり0.10ドル程度）。AWSアカウントが必要です。すでにAmazonインフラストラクチャを使用しているアプリケーションに最適です。

### Postmark
優れた配信率を持つトランザクションメールに特化。速度と信頼性を重視。詳細な分析とバウンス処理。

### さくらのメールボックス
日本国内で信頼性の高いメールサービス。日本語サポートが充実しており、国内配信に最適化されています。

### お名前メール
国内ドメインレジストラが提供するメールサービス。ドメインと一緒に管理できる利便性があります。

### Resend
開発者向けに設計された最新のメールAPI。クリーンなインターフェース、優れたドキュメント、充実した無料枠。

## SMTP設定の仕組み

メールサービスプロバイダーを選択してアカウントを作成すると、接続の詳細（サーバーアドレス、ポート番号、ユーザー名、パスワード）が提供されます。AIにメール配信を設定したいと伝え、これらの詳細を提供すると、AIは次のことを行います：

1. **資格情報を安全に保存** - パスワードはデータベースで暗号化されます
2. **接続設定を構成** - サーバーアドレス、ポート、暗号化タイプ（TLS/SSL）
3. **接続をテスト** - 保存前に設定が機能することを確認します
4. **レート制限を設定** - 適切な日次および時間次制限を構成します
5. **送信者情報を更新** - 「from」アドレスと表示名を設定します

その後、アプリケーションがメールを送信すると、デフォルトのプラットフォームサーバーではなく、設定したサービスを通じて送信されます。

## メール設定の管理

管理インターフェースを通じて、次のことができます：
- マスクされた資格情報で現在のSMTP設定を表示
- メール使用量を確認（この時間と今日送信された数）
- 送信者情報を更新（fromアドレス、表示名、reply-toアドレス）
- 接続をテストして設定を確認
- ニーズに基づいてレート制限を調整
- 必要に応じてデフォルトのプラットフォームサーバーにリセット

プロバイダーを変更したり制限を変更したりする場合、AIもこれらの設定を更新できます。

## セキュリティとプライバシー

**暗号化されたストレージ**: SMTPパスワードはデータベースで暗号化され、保存後は完全には表示されません。`****xyz789`のようなマスクされたバージョンが表示され、完全な値を公開せずにどのパスワードが保存されているかを確認できます。

**接続セキュリティ**: システムは、メールプロバイダーとの安全な通信のための最新のTLS暗号化をサポートしています。資格情報は暗号化されずに送信されることはありません。

**レート制限**: 自動強制により、暴走したメール送信を防ぎ、メールプロバイダーでの評判と予期しないコストの両方を保護します。

## ベストプラクティス

✅ **早期にカスタムSMTPを設定** - 本番アプリケーションではデフォルトのレート制限（1日2通）に頼らないでください。独自のメールサービスを設定してください。

✅ **適切なプロバイダーを選択** - ボリュームニーズ、予算、詳細な分析などの高度な機能が必要かどうかを検討してください。

✅ **使用量を監視** - 管理インターフェースでメール使用量統計を確認して、レート制限内にいることを確認してください。

✅ **本番前にテスト** - SMTP接続テスト機能を使用して、設定が正しく機能することを確認してください。

❌ **テストをスキップしない** - 本番前にSMTP接続テスト機能を使用して設定を確認してください。

❌ **配信性を無視しない** - 評判の良いメールサービスプロバイダーを選択して、メールが実際に受信者に届くようにしてください。

---

**関連ドキュメント：**
- [メールテンプレート →](/ja/cloud/email-templates)
- [シークレット管理 →](/ja/cloud/secrets)
- [管理インターフェース →](/ja/cloud/admin)
